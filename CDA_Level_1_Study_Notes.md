# 第 1 章 绪论

## 1.1 数据分析概述

### 1.1.1 数据分析的分类

用于商业决策的数据分析方法主要分为：**业务描述性分析方法**与**数据挖掘分析方法**两大类。

（二者分别对应统计学中的**描述性分析**和**预测性分析**）

- *业务描述性分析方法*
  - 分析对象：数据
  - 主要途径：探索数据内的有用信息
  - 最终目标：解决业务需求
  - 分析流程：业务理解、数据采集、数据清洗、数据探索、数据可视化、数据建模、模型结果可视化、分析结果的业务应用
- *数据挖掘分析方法*
  - 数据挖掘是一个横跨计算机、数学、统计学等学科的科学分支；
  - 它是用人工智能、机器学习、统计学和数据库的交叉方法在相对较大型的数据集中发现信息的计算过程；
  - 数据分析的工作内容涵盖数据挖掘的工作内容。

数据分析在企业中可分为：**宏观分析**和**微观分析**两大类。

- 宏观分析：站在**企业**经营和运营的视角，为决策层和管理层提供数据支持；
- 微观分析：站在**客户**的视角，进行客户洞察，挖掘客户需求和匹配产品与服务。

### 1.1.2 数据分析的基本流程

#### 业务描述性分析流程 (CDA LEVEL I)

1. **业务理解：** 业务描述性分析的起点，流程中最重要的步骤，要求分析人员能够全面、准确地理解业务问题及业务需求，并结合业务需求制订完整的分析计划；
2. **数据获取：** 基于业务分析的需求，从多渠道全面地获取分析数据；
3. **数据处理：** 将*<u>原始数据 (Raw Data)</u>*进行清洗、加工，得到高质量的可用来进行分析的有效数据的过程；
4. **数据分析：** 对处理过后的有效数据进行业务描述性分析的过程；
5. **结果展现：** 将分析结果以业务分析报告或可视化报表（仪表盘、商业智能报表等）的形式呈现给业务决策者的过程。

#### 数据挖掘流程概述 (CDA LEVEL II, III)

***<u>CRISP-DM方法论</u>***

1. **业务理解 (Business Understanding)**
2. **数据理解 (Data Understanding)**
3. **数据准备 (Data Preparation)**
4. **建模 (Modeling)**
5. **模型评估 (Evaluation)**
6. **模型部署 (Deployment)**

<img src="_assets\CRISP-DM.png" alt="CRISP-DM方法流程图" style="zoom:50%;" />

### 1.1.3 数据分析的落地方法

CDA提出的 <span style="color: red">**EDIT 数字化模型**</span>是企业引入数据分析的落地模板。

这个模型包含4个部分：**探索 (Exploration) **、**诊断 (Diagnosis)** 、**指导 (Instruction)** 和**工具 (Tool)**。

## 1.2 数据分析师概述

### 1.2.1 数据分析师的不同角色与职责

1. 从工作内容角度划分职责
   - 纯数据相关类岗位
   - 数据赋能类岗位
2. 从知识层级的角度划分职责
   - 业务数据分析师
   - 建模算法分析师
   - 数据科学家

### 1.2.2 数据分析师职业道德和行为准则

#### 数据分析师职业道德

见书 P11，了解即可。

#### 数据分析师专业行为准则

见书 P11-12，了解即可。

## 1.3 数据相关的安全与立法

### 1.3.1 各国的数据隐私相关法律

欧盟的 **《通用数据保护条例》(General Data Protection Regulation, GDPR)**：

1. **企业在收集用户的个人信息之前，必须以简洁、透明且易懂的形式，清晰和平白的语言向用户说明**将收集用户的哪些信息、收集到的信息将如何进行存储、存储的信息会如何使用、企业的联系方式等；
2. 用户享有的权利：
   - 数据访问权：用户有权向企业问询个人信息是否正在被处理等；
   - 被遗忘权：用户有权要求企业删除个人数据；
   - 限制处理权：用户有权禁止企业将个人信息用于特定的用途；
   - 数据携带权：当用户想离开某个平台时，可以要求平台将其在该平台产生的数据提供给自己。

### 1.3.2 我国大数据立法的历程和展望

书 P14-16，了解即可。

# 第 2 章 表格结构数据与表结构数据

在大数据时代背景下，我们使用的数据主要包含两种类别，一种称为**结构化数据**，另一种称为**非结构化数据**。

- **结构化数据：** 数据结构规范、完整的数据；
- **非结构化数据：** 数据结构不规范、不完整、格式多样、难以理解、难以进行标准化处理的数据。

CDA LEVEL I 主要针对结构化数据，*根据使用的 IT 工具的不同*，其可分为：

- **表格结构数据**
  - IT 工具：Excel、WPS 表格、Numbers
- **表结构数据**
  - IT 工具：数据库、ETL 工具、可视化工具

## 2.1 表格结构数据

### 2.1.1 表格结构数据概述

表格结构数据是指**应用在电子表格工具上的数据**。表格结构数据需要用电子表格工具对其进行处理加工、分析及展现。

### 2.1.2 表格结构数据特征

1. 处理的**基本单位**是**单元格**；
2. 不同的单元格可以设置不同的**数据类型**；
   - **数值型：** 包含整数值与小数值的信息，主要用来进行<span style="color: red">**数学计算**</span>；
   - **文本型：** 包含文字、符号、数字等信息，主要用来对文本内容进行<span style="color: red">**描述**</span>；
   - **逻辑型：** 只包含真值 (`true`) 与假值 (`false`) 两种信息，主要用来进行<span style="color: red">**逻辑判断**</span>。
3. 一个单元格不仅具有**数据类型**的属性，还具有**单元格格式**的属性。

## 2.2 表格结构数据的获取、引用与使用

### 2.2.1 表格结构数据的获取

业务数据分析中应用的表格结构数据有 3 个主要来源：

1. **企业的后台数据库系统：** 数据库系统
   - 为了能够尽量做到一次性获取到完整、准确的可用数据，分析人员在向数据库管理人员提需求时应尽量做到以下 4 点：
     - 需求中业务描述部分应尽量准确、详细、易懂；
     - 需求中的数据使用部分的描述应尽量做到条理清晰、逻辑严谨、细节描述详细；
     - 需求描述结束后需要确认数据库管理人员是否听懂并理解了需求内容；
     - 向数据库管理人员询问获取数据的方案，与数据库管理人员一起逐一核对方案细节。
2. **企业的前端操作平台：** ERP、CRM、财务系统等
   - 优点：高效、方便；
   - 缺点：只能导出提前设定好的数据，设定之外的还要从数据库中获取，还需要看是否有权限。
3. **企业外部渠道：** CSV、TXT、XLSX、ET 等

### 2.2.2 表格结构数据的引用、查询与计算方法

#### 表格结构数据的引用方法

1. 可以进行单元格计算、单元格区域与单元格区域间的计算；
2. 可以引用单元格值，可以引用其他工作表中的单元格。

#### 表格结构数据的查询方法

1. 使用表格工具搜索功能；
2. 使用函数查找。

***“=”、操作符、函数表达式、参数、返回值都是表格结构数据中使用函数的构成部分。***

#### 表格结构数据的计算方法

1. 直接计算：使用运算符连接单元格或单元格区域进行计算；
2. 函数计算：使用函数进行计算。
   - 查找类函数：`VLOOKUP()`、`OFFSET()` 等；
   - 文本类函数：`MID()`、`LEN()`、`SUBSTITUTE()` 等；
   - 数学类函数：`INT()`、`MOD()`、`ABS()` 等。

## 2.3 表结构数据

### 2.3.1 表结构数据概述

1. 概念：以<span style="color: red">**字段 (Field)**</span> 或<span style="color: red">**记录 (Record)** </span>作为数据的引用、操作及计算的基本单位的数据 **（表是由不同字段构成的）**；
   - **字段：** 整列数
   - **记录：** 整行数据
   - **维度 (Dimension) ：** 文本型字段
   - **度量 (Metric) ：** 数值型字段
2. 表分类
   - **维度表：** 只包含维度信息的表
   - **事实表：** 既包含维度信息，又包含度量信息的表

### 2.3.2 表结构数据特征

1. **表结构数据中的基本引用、操作、计量单位是字段或记录；**
   - 第一行为标题行；
   - 第二行以后为记录；
   - 字段不能重名；
   - 一个字段只能有一种数据类型。
2. **在表中，所有字段的记录行数相同；**
   - 方形结构；
   - 记录行数相同；
   - 存在空值（缺失值）；
   - 处理缺失值：
     - 文本型字段
       - 影响不大：可以不进行处理，也可以用其他没有实际业务含义的文本字符对缺失值进行替换；
       - 影响大：找业务人员进行确认后进行替换，或者与业务人员核实后删除。
     - 数值型字段
       - 综合考虑该数值型字段所代表的度量意义以及针对该数值型字段进行汇总计算的方式来最终决定对缺失值的具体处理方法。
3. **一般而言，一个表中有且只有一个主键 (Primary Key)。**
   - 物理意义
     - 单字段主键：由一个字段构成的主键；
     - 多字段联合主键：由多个字段构成的主键；
     - 主键非空且不重复；
     - 定位记录行、字段名+主键值具体定位；
     - 多以 “xxID”、“xxNO”、“xx编号” 等命名。
   - 业务意义
     - 区分每一行业务记录。在一个数据表中，所有非主键字段都要围绕主键展开。

## 2.4 表结构数据的获取、加工与使用

### 2.4.1 表结构数据的获取

1. **应用**表格结构数据
2. **引用**表结构数据——可以引用多数据源数据

**引用数据源**的方式比**应用数据源**的方式更加可以保证数据的时效性与准确性。

### 2.4.2 数据库与商业智能的概念解析

**ETL (Extract-Transform-Load)** 是将分析时使用的数据从数据源经过**抽取 (Extract)**、**清洗转换 (Transform)** 之后**加载 (Load)** 到数据仓库的过程。

**关系数据库管理系统 (RDBMS)** 是**联机事务处理系统 (On-Line Transaction Processing, OLTP)** 的一个重要环节，在整个计算机应用系统中主要承担着**数据的存储与读取**的任务。

### 2.4.3 表结构数据的合并

表结构数据的合并方式可以分为**横向合并**和**纵向合并**两类。

1. **横向合并：** 将不同表中的信息合并到同一个表中使用；
   - **通过公共字段匹配：** 既不需要字段名相同，也不需要每条记录内容都能匹配在一起，只要大多数记录匹配就可以进行合并；
   - **左表与右表：** 写 SQL 命令时，写在连接命令前面的表称为左表，写在后面的称为右表；
   - **连接方向：** 左连接 `LEFT JOIN`、右连接 `RIGHT JOIN`、内连接 `INNER JOIN`；
   - **对应关系：** 多对多、一对一、一对多；
   - **E-R 图 (Entity Relationship Diagram) ：** 标识多表连接关系的 “鸟瞰图”。
2. **纵向合并：** 多表中记录信息合并到同一表中进行使用；
   - 字段个数相同
   - 相同位置字段的数据类型相同
   - **去重合并：** 将记录内容完全相同的记录行去重后再合并；
   - **全合并：** 不去除重复内容的记录行，直接合并。

### 2.4.4 表结构数据的汇总

**数据透视分析方法**——对零散数据进行汇总分析。

- **维度：** 业务观测角度
- **度量：** 业务行为结果
  - 维度筛选度量，度量被维度筛选。
- **汇总计算规则：** 衡量业务行为结果好坏的测量仪
  - 合计规则：将相同维度值下的多个度量值加在一起 (`SUM`)；
  - 计数规则：对相同维度值下的度量个数进行计数 (`COUNT`)；
  - 平均规则：用合计规则的结果除以计数规则的结果（平均 = 合计 / 计数）(`AVERAGE`)；
  - 最大值规则：求相同维度下最大的度量值 (`MAX`)；
  - 最小值规则：求相同维度下最小的度量值 (`MIN`)。

# 第 3 章 数据库应用

## 3.1 数据库相关概念

### 3.1.1 数据库简介

#### 什么是数据库

不考，略。

#### 数据库分类

1. 关系数据库：用来存放结构化数据；
2. 非关系数据库：用来存放非结构化数据。

### 3.1.2 认识数据库

#### 数据库数据处理流程

不考，略。

#### 数据库的整体框架

在关系数据库中，数据库是按照**字段**、**数据表**、**数据库**的结构来存储和调用数据的。

*一个数据库里有 n 张数据表，一张数据表里有 n 个字段。*

#### 数据库、数据库管理系统和 SQL 之间的关系

1. **数据库：**存储、调用、分析相关数据的**仓库**；
2. **数据库管理系统：**用于管理数据库的**软件**，一个数据库管理系统可以管理多个数据库；
3. **SQL (Structure Query Language, 结构化查询语言) ：**国际标准化组织 (ISO) 采纳的标准的数据库**语言**，是用来对数据库进行存储、计算、查询、更新、管理等操作的语言。

### 3.1.3 SQL

#### SQL 的分类及应用

根据不同的操作类型，SQL 可以分为以下 4 类：

1. **数据定义语言 (DDL)** 
   - 用于创建、修改、删除数据库中的各种<span style="color: red">**对象**</span>（数据库、表、视图、索引等）；
   - 对于业务分析人员来说，可以使用 DDL 完成分析逻辑的自用数据库的建设和修改；
   - 常用的命令有 `CREATE`、`ALTER`、`DROP`。

2. **数据库操作语言 (DML)**
   - 用于**操作**数据库表中的<span style="color: red">**记录**</span>；
   - 业务分析人员如果在分析时需要添加其他数据源的数据或者在删除不符合条件1数据时可以使用 DML；
   - 常用的命令有 `INSERT`、`UPDATE`、`DELETE`。

3. **数据查询语言 (DQL)**
   - 用于**查询**数据库表中的<span style="color: red">**记录**</span>；
   - 是业务分析人员**最常用**的语言类型，贯穿信息获取、数据获取、数据理解、数据清洗等多个环节；
   - 主体结构为：

```mysql
SELECT <字段名> FROM <表或视图名> WHERE <查询条件>
```

4. **数据控制语言 (DCL)**
   - 用于定义数据库访问权限和安全级别；
   - 业务分析人员通常不涉及该类型命令的使用，常用于数据库管理员为业务分析人员开放数据库相关权限；
   - 常用的命令有 `GRANT`、`REVOKE`。

#### SQL 的特点

1. 书写要求
   - SQL 对格式容忍度很高，对缩进、换行、大小写等均不敏感；
   - 尽管 SQL 对格式要求不高，但是在编写脚本时，应该统一大小写，并配合换行和缩进来增强语句的可读性。
2. 注释
   - 单行注释：`-- + 空格 + 注释内容或者 # + 注释内容`
   - 多行注释：`/* 注释内容 */`

### 3.1.4 数据仓库

不考，略。

## 3.2 数据定义语言

数据定义语言 (DDL) 是用来对数据库管理系统中的**对象**进行**增、删、改、查**的操作语言。

### 3.2.1 DDL 在业务中的应用

不考，略。

### 3.2.2 定义数据库

#### 创建数据库

基础语法格式：`CREATE DATABASE <数据库名称>;`

```mysql
# 创建一个名为 test 的数据库
CREATE DATABASE test;
```

#### 查看数据库

基础语法格式：`SHOW DATABASES;`

```mysql
# 查看当前用户权限内的所有数据库
SHOW DATABASES;
```

#### 选择数据库

基础语法格式：`USE <数据库名称>;`

```mysql
# 使用创建好的 test 数据库
USE test;
```

#### 删除数据库

基础语法格式：`DROP DATABASE <数据库名称>;`

```mysql
# 删除创建好的 test 数据库
DROP DATABASE test;
```

### 3.2.3 数据表

#### 数据字典

数据字典是一个**用来描述数据表信息的表格**，可以存储在数据库中，也可以以独立的说明文档的形式保存在数据库系统之外。

一般来说，数据字典会包括**表名、表的描述信息、字段名、字段描述、字段对应的数据类型、约束、初始值**等信息。

#### 创建表

需要特别注意的是，在创建表时，**一定要声明使用的数据库**，即 `USE <数据库名称>;`。

基础语法格式：

```mysql
CREATE TABLE <表名> (
    <字段名1> <数据类型1> <约束条件1>,
    ...
    <字段名n> <数据类型n> <约束条件n>
);
```

当数据表没有约束条件时，可以不指定。

```mysql
# 1. 使用 test 数据库
USE test;
# 2. 创建部门信息表
CREATE TABLE dept (
    depid CHAR(3),
    depname VARCHAR(20),
    peoplecount INT
);
```

#### 查看表

##### 查看数据库下的所有表

基础语法格式：`SHOW TABLES;`

```mysql
# 查看当前数据库中的所有表
SHOW TABLES;
```

##### 查看表结构

若查看表之前未声明该表所在的数据库，则需要**用限定符指定数据库名称.表名**。

基础语法格式：`DESCRIBE <表名>;` 或 `DESC <表名>;`

```mysql
# 查看表结构
DESCRIBE test.dept;
```

#### 修改表

##### 修改表名

对表名进行修改，不用考虑被修改的表中是否有数据。

基础语法格式：`ALTER TABLE <原表名> RENAME <新表名>;`

```mysql
# 将 dept 表名改为 department
ALTER TABLE dept RENAME department;
```

##### 修改字段名

对字段名进行修改，不用考虑被修改的字段中是否有数据。

基础语法格式：`ALTER TABLE <表名> CHANGE <原字段名> <新字段名> <新数据类型>;`

```mysql
# 修改字段名 depid 为 depno
ALTER TABLE department CHANGE depid depno CHAR(3);
```

##### 修改字段类型

基础语法格式：`ALTER TABLE <表名> MODIFY <字段名> <新数据类型>;`

```mysql
# 修改 depno 的字段类型为 VARCHAR(5)
ALTER TABLE department MODIFY depno VARCHAR(5);
```

##### 添加新字段

添加字段的位置可以指定，在不指定的情况下会默认将新字段添加到表中的最后一列。

基础语法格式：`ALTER TABLE <表名> ADD <新字段名> <数据类型> <约束条件> <FIRST/AFTER 参照字段名>;`

```mysql
# 在 department 表中添加新字段 city
ALTER TABLE department ADD city VARCHAR(10);
```

##### 修改字段的排列位置

- 通常将主键放在第一或前几列；
- 常用或重要的字段排在表的前列；
- 同类型的字段尽可能根据业务逻辑排列在一起。

基础语法格式：`ALTER TABLE <表名> MODIFY <字段名> <数据类型> FIRST/AFTER <参照字段名>;`

```mysql
# 修改字段 city 的排列位置到 depno 后面
ALTER TABLE department MODIFY city VARCHAR(10) AFTER depno;
```

##### 删除字段

基础语法格式：`ALTER TABLE <表名> DROP <字段名>;`

```mysql
# 删除字段 city
ALTER TABLE department DROP city;
```

#### 删除表

`IF EXISTS` 主要用于判断表名是否存在，如果表名输入错误，语句也不会报错，会正常执行，但是需要删除的表并没有被删除。

基础语法格式：`DROP TABLE [IF EXIST] <表名1>, <表名2>, ..., <表名n>;`

```mysql
# 删除 department 表
DROP TABLE department;
```

### 3.2.4 数据类型

数据库中常用的数据类型有：**数值型**、**字符串型（文本型）**、**日期时间型**。

#### 定义数据类型

计算机专业本科学过，略。

#### 数值型

##### 整数型

详见书 P89 表 3-3。

##### 小数型

详见书 P90。

#### 字符串型

详见书 P90-91。

#### 日期时间型

详见书 P91-92。

### 3.2.5 约束条件

#### 定义约束条件

|     约束条件     |     说明     |                  语法                  |
| :--------------: | :----------: | :------------------------------------: |
|  `PRIMARY KEY`   |   主键约束   |   `<字段名> <数据类型> PRIMARY KEY`    |
|    `NOT NULL`    |   非空约束   |     `<字段名> <数据类型> NOT NULL`     |
|     `UNIQUE`     |   唯一约束   |      `<字段名> <数据类型> UNIQUE`      |
| `AUTO INCREMENT` | 自动增长约束 |  `<字段名> <数据类型> AUTO INCREMENT`  |
|    `DEFAULT`     |   默认约束   | `<字段名> <数据类型> DEFAULT <默认值>` |

1. `PRIMARY KEY` ：唯一标识表中的每行记录，要求字段中的数据记录是**非空**和**唯一**的；
2. `NOT NULL` ：限制字段中的数据记录不能有空值；
3. `UNIQUE` ：限制字段中的数据记录不能有重复值；
4. `AUTO INCREMENT` ：需要**和主键约束一起使用**，并且只有**整数型字段**才可以添加自动增长约束；
5. `DEFAULT` ：为字段设置默认值；
6. 除了上述 5 种，SQL 还使用**外键约束**来指定表和表之间的依赖关系，该约束条件受到实际业务的限制，在企业数据库中极少用到。

#### 主键约束

##### 单字段主键约束

基础语法格式：

```mysql
CREATE TABLE <表名> (
    <字段名1> <字段类型1> PRIMARY KEY,
    ...
    <字段名n> <字段类型n>
);
```

```mysql
CREATE TABLE dept (
    # 单字段主键
    depid CHAR(3) PRIMARY KEY,
    depname VARCHAR(20),
    peoplecount INT
);
```

##### 多字段主键约束

基础语法格式：

```mysql
CREATE TABLE <表名> (
    <字段名1> <字段类型1>,
    ...
    <字段名n> <字段类型n>,
    [CONSTRAINT 主键约束名] PRIMARY KEY (<字段名1>, ..., <字段名k>)
);
```

```mysql
CREATE TABLE dept (
    depid CHAR(3) PRIMARY KEY,
    depname VARCHAR(20),
    peoplecount INT
    # 多字段联合主键
    PRIMARY KEY (depname, depid)
);
```

主键约束可以删除。

基础语法格式：`ALTER TABLE <表名> DROP PRIMARY KEY;`

```mysql
# 删除表中的主键约束
ALTER TABLE dept DROP PRIMARY KEY;
```

#### 唯一约束

##### 创建唯一约束

基础语法格式 1：

